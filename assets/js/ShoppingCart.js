(function(){"use strict";var r;r=angular.module("ShoppingCart",["OrderService","ProtocolService","AthleteService","CompoundService","BTCService","PubNubService"]),r.controller("ShoppingCartController",["$scope","$rootScope","$element","BTCrate","Athlete","Protocol","Compounds","Order","PubNub",function(r,e,t,o,n,c,a,d,i){return r.BTCrate=o,window.ShoppingCart=r.order=d.create(),r.$on("PubNubService : Athlete Connected",function(){return window.ShoppingCart=r.order=d.create()}),r.Compounds=a,r.$on("Context Switch",function(e,t){return r.visibleShoppingCart=_.contains(["Search","Editor"],t)}),r.$on("ShoppingCart : Add Item",function(e,t){return null==r.order.cart[t]?r.order.cart[t]={qty:1,protocol:c(t)}:r.order.cart[t].qty+=1}),r.$watch("order.referral",function(){return null!=r.order.referral&&""!==r.order.referral?i("OrderService : Verify Referral Code",r.order.referral):void 0}),r.$on("OrderService : Referral Code Is Valid",function(e,t){return t===r.order.referral?r.$evalAsync(function(){return r.referralCodeValid=!0}):void 0}),r.$on("OrderService : Referral Code Is Invalid",function(e,t){return t===r.order.referral?r.$evalAsync(function(){return r.referralCodeValid=!1}):void 0}),r.increaseQty=function(e){return r.order.cart[e].qty+=1},r.decreaseQty=function(e){return r.order.cart[e].qty>1?r.order.cart[e].qty-=1:void 0},r.deleteItem=function(e){return delete r.order.cart[e]},r.accessoryQty=function(){var e;return e=0,_.each(r.order.cart,function(r){return e+=r.qty*r.protocol.accessoriesQty}),r.order.accessoryQty=e,e},r.accessoryPriceUSD=function(){var e;return 0===r.accessoryQty()?0:r.referralCodeValid===!0?0:(e=.2*r.accessoryQty(),e+=10,e+=3)},r.grandTotal=function(){var e;return e=0,_.each(r.order.cart,function(r){return e+=r.protocol.priceUSD*r.qty}),e+=r.accessoryPriceUSD()},r.orderReady=function(){return _.isEmpty(r.order.cart)?[!1,"Add A Protocol"]:r.order.name.length>0&&r.order.address.length>0&&r.order.city.length>0&&2===r.order.state.length&&r.order.zip.length>=5?[!0,"Checkout"]:[!1,"Address Incomplete"]},r.checkout=function(){return r.orderReady()[0]?(r.order.grandTotal=r.grandTotal(),r.order.accessoryQty=r.accessoryQty(),r.order.place(),window.ShoppingCart=r.order=d.create(),e.$broadcast("Context Switch","Athlete Profile")):void 0}}]),r.directive("shoppingCart",function(){return{restrict:"E",templateUrl:"assets/templates/ShoppingCart.html",controller:"ShoppingCartController",controllerAs:"ShoppingCartCtrl",scope:!0,replace:!0}})}).call(this);