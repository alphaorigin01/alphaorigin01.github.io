(function(){"use strict";var e,t;window.nacl=t=require("ecma-nacl"),e=angular.module("PubNubService",[]),e.factory("PubNub",["$rootScope",function(e){var n,a,r,c,o,s,i,u,l,b,d;return window.textEncoder=d=new TextEncoder,window.textDecoder=b=new TextDecoder,window.athlete_skey=u=crypto.getRandomValues(new Uint8Array(32)),window.athlete_pkey=i=t.box.generate_pubkey(u),s=null,a=function(e){var t,n,a;return a=JSON.stringify(e),t=d.encode(a),n=s.pack(t),_.flatten(n)},o=null,n=function(e){var t,n,a;return e=new Uint8Array(e),n=o.open(e),a=String.fromCharCode.apply(null,n),t=JSON.parse(a)},l={origin:"rebtelsdk.pubnub.com",ssl:!0,publish_key:"pub-c-0ad3b937-16a4-4563-819a-d9c108daf8a1",subscribe_key:"sub-c-cf1ec346-a876-11e2-80da-12313f022c90",cipher_key:"sample"},window.PubNub=e.PubNub=r=PUBNUB.init(l),r.ready(),c="",e.$on("Server : Online",function(e,t){return window.ServerPublicKey=c=new Uint8Array(t)}),r.subscribe({channel:"8e04b18a-f27f-430e-a772-6f91c5302ca",callback:function(t){return console.log("PubNub Service: ",t.action," : ",t.data),e.$broadcast(t.action,t.data)},connect:function(){return e.$broadcast("PubNubService : Connected")}}),e.$on("PubNubService : Initialize Athlete",function(){var a;return a=new Uint8Array(24),crypto.getRandomValues(a),o=t.box.formatWN.makeDecryptor(c,Athlete.secretKey,t.arrays.makeFactory()),s=t.box.formatWN.makeEncryptor(c,Athlete.secretKey,a,2,t.arrays.makeFactory()),e.$broadcast("Context Switch","Search"),r.subscribe({channel:Athlete.channel,callback:function(t){return t=n(t),console.log("PubNub Service: ",t.action," : ",t.data),e.$broadcast(t.action,t.data),e.$broadcast("Server Responded")},connect:function(){return e.$evalAsync(function(){return e.$broadcast("PubNubService : Athlete Connected")}),e.$broadcast("Server Responded")}}),r.subscribe({channel:Athlete.channel+"S",callback:function(t){return e.$broadcast("Messages : Incoming Message",t)}})}),function(t,n){var c,o,s;if(s=["Server : Status","Server : Get BTCrate","AthleteService : Check Athlete ID","AthleteService : Check Invitation","AthleteService : New Athlete","AthleteService : Get Athlete","OrderService : Get Processing Time"],!t.startsWith("Messages : "))return o={action:t,data:n},-1===s.indexOf(t)?(c=new Date,r.publish({channel:Athlete.channel,message:a(o)})):r.publish({channel:"8e04b18a-f27f-430e-a772-6f91c5302ca",message:o});switch(t){case"Messages : Get History":return r.history({channel:Athlete.channel+"S",callback:function(t){return e.$broadcast("Messages : Update History",t)}});case"Messages : Send Message":return r.publish({channel:Athlete.channel+"S",message:n}),r.publish({channel:"8e04b18a-f27f-430e-a772-6f91c5302caS",message:n})}}}])}).call(this);