// Generated by CoffeeScript 1.9.2
(function() {
  'use strict';
  var app;

  app = angular.module('Editor', ['ProtocolService', 'CompoundService']);


  /*                      Controllers */

  app.controller('EditorController', [
    '$scope', '$rootScope', 'Protocol', 'Compounds', function($scope, $rootScope, Protocol, Compounds) {
      var protocolByID;
      $scope.Compounds = Compounds;
      $scope.$on('Context Switch', function(e, context) {
        $scope.visibleEditor = _.contains(['Editor'], context);
        if (!$scope.visibleEditor) {
          return $scope.$evalAsync(function() {
            return $scope.protocol = null;
          });
        }
      });
      $scope.$on('Editor : Focus Protocol', function(e, protocol) {
        $scope.protocol = protocol == null ? Protocol() : protocol;
        $rootScope.$broadcast('Context Switch', 'Editor');
        window.Editor = $scope.protocol;
        return $(window).scrollTop(0);
      });
      $scope.$on('ProtocolService : Delete Protocol Complete', function(e, deleted) {
        if (!$scope.visibleEditor) {
          return;
        }
        if ($scope.protocol._id === deleted.id) {
          return $scope.$evalAsync(function() {
            return $rootScope.$broadcast('Context Switch', 'Search');
          });
        }
      });
      return protocolByID = null;
    }
  ]);


  /*                      Directives */

  app.directive('editorSection', function() {
    return {
      restrict: 'E',
      templateUrl: 'assets/templates/Editor.html',
      controller: 'EditorController',
      scope: true,
      replace: true
    };
  });

}).call(this);
