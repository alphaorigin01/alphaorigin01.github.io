(function(){"use strict";var e;e=angular.module("OrderService",["ProtocolService","AthleteService","PubNubService","BTCService"]),e.factory("Order",["Protocol","Athlete","PubNub","BTCrate","$rootScope","$timeout",function(e,r,t,i,n,c){var o,d;return o=function(){function e(){var e;this._id="order_"+r._id+"_"+Date.now().toString(36).toUpperCase(),this.date=new Date,this.athlete=r._id,this.cart={},this.accessoryQty=0,this.accessoryPriceUSD=0,this.grandTotal=0,this.referral="",this.name="",this.address="",this.address2="",this.city="",this.state="",this.zip="",this.fulfillment={paymentRecieved:!1,paymentTimestamp:"",preparedMaterials:!1,formulatedProtocols:!1,shipped:!1,shippedTimestamp:"",tracking:"",complete:!1},e=this,n.$on("OrderService : Update Tracking Info",function(r,t){return t.id===e._id?n.$evalAsync(function(){var r,i,n,c,o;for(e.trackingInfo=t.trackingInfo,e.trackingInfo.deliveryDay=new Date(e.trackingInfo.deliveryDay),c=e.trackingInfo.history,o=[],r=0,n=c.length;n>r;r++)i=c[r],o.push(i.date=new Date(i.date));return o}):void 0}),n.$on("OrderService : Update Order",function(r,i){return i._id===e._id?n.$evalAsync(function(){return _.extend(e,i),e.fulfillment.shipped?t("OrderService : Get Tracking Info",e._id):void 0}):void 0})}return e.prototype.place=function(){return null==this._rev?t("OrderService : Place Order",this):void 0},e}(),window.Orders=d=[],n.$on("PubNubService : Athlete Connected",function(){return t("OrderService : Get Order List",r)}),n.$on("OrderService : Update Order List",function(e,i){return n.$evalAsync(function(){var e,n,c,a;for(d.splice(0,d.length),e=0,n=i.length;n>e;e++)a=i[e],d.push(c=new o(r._id)),c._id=a.id,t("OrderService : Get Order",a.id);return d.reverse()})}),n.$on("OrderService : Order Placed",function(){return t("OrderService : Get Order List",r)}),{create:function(){return new o(r._id)},get:function(){return d}}}])}).call(this);