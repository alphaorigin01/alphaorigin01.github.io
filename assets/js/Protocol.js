(function(){"use strict";var e;e=angular.module("Protocol",["ProtocolService","AthleteService","CompoundService","PubNubService"]),e.controller("ProtocolController",["$rootScope","$scope","$http","$element","$timeout","Protocol","Athlete","Compounds","PubNub",function(e,t,r,o,n,i,c,a,l){return t.tab=1,t.selectTab=function(e){return t.tab=e},t.isSelected=function(e){return t.tab===e},t.formulation_tab=1,t.formulation_selectTab=function(e){return t.formulation_tab=e},t.formulation_isSelected=function(e){return t.formulation_tab===e},t.Athlete=c,t.Compounds=a,t.Math=window.Math,t.active_stars=0,t.selected_stars=c.stars[t.protocol._id]?c.stars[t.protocol._id]:0,t.hover_stars=0,t.$on("ProtocolService : Update Stats",function(e,r){return r.protocol===t.protocol._id?t.active_stars=Math.round(r.stars/r.athletes):void 0}),l("ProtocolService : Get Stats",t.protocol),t.set_stars=function(e){return t.selected_stars=e,c.setStars(t.protocol._id,e),l("ProtocolService : Get Stats",t.protocol)},t.calendar=[[1,2,3,4,5,6,7],[71,72,73,74,75,76,77],[8,9,10,11,12,13,14],[78,79,80,81,82,83,84],[15,16,17,18,19,20,21],[85,86,87,88,89,90,91],[22,23,24,25,26,27,28],[92,93,94,95,96,97,98],[29,30,31,32,33,34,35],[99,100,101,102,103,104,105],[36,37,38,39,40,41,42],[106,107,108,109,110,111,112],[43,44,45,46,47,48,49],[113,114,115,116,117,118,119],[50,51,52,53,54,55,56],[120,121,122,123,124,125,126],[57,58,59,60,61,62,63],[127,128,129,130,131,132,133],[64,65,66,67,68,69,70],[134,135,136,137,138,139,140]],t.selected_day=1,t.set_selected_day=function(e){return t.selected_day=e},t.select_next_day=function(){return t.selected_day+=1},t.select_previous_day=function(){return t.selected_day>1?t.selected_day-=1:void 0},t.ordinal=function(e){var t,r;return t=["th","st","nd","rd"],r=e%100,t[(r-20)%10]||t[r]||t[0]},t.day_has_dose=function(e){return _.isArray(t.protocol.schedule[e])},t.dose_for_selected_day=function(e){var r,o,n,i,c,a,l,s,u,d;for(o=0,a=t.protocol.formulations[e].schedules,n=0,c=a.length;c>n;n++)if(d=a[n],d.startDay===t.selected_day)o+=d.loadingVolume;else for(r=i=l=d.startDay,s=d.startDay+d.duration-d.interval,u=d.interval;u>0?s>=i:i>=s;r=i+=u)r===t.selected_day&&(o+=d.doseVolume);return o},t.is_search_results=function(){return"search_results"===$(o).parent().attr("id")},t.toggle_experience_choices_visible=function(){return c._id!==t.protocol.owner||t.is_search_results()?void 0:t.experience_choices_visible=!t.experience_choices_visible},t.toggle_goal_choices_visible=function(){return c._id!==t.protocol.owner||t.is_search_results()?void 0:t.goal_choices_visible=!t.goal_choices_visible},t.add_to_cart_text=function(){return t.is_search_results()?"View & Buy":"Add To Cart"},t.add_to_cart=function(){return t.is_search_results()?e.$broadcast("Editor : Focus Protocol",i(t.protocol._id)):e.$broadcast("ShoppingCart : Add Item",t.protocol._id)},t.isFavorite=function(){return _.indexOf(c.favorites,t.protocol._id)>=0},t.favorite=function(){return c.toggleFavorite(t.protocol._id)},t.destroy=function(){return i(t.protocol._id,!0)}}]),e.controller("RegimenController",["$scope","$element","$timeout","Athlete","Compounds",function(e,t,r,o,n){return e.increase_interval=function(){return e.regimen.interval=e.regimen.interval+1,e.regimen.duration=Math.round(e.regimen.duration/e.regimen.interval)*e.regimen.interval},e.decrease_interval=function(){return e.regimen.interval>1?(e.regimen.interval=e.regimen.interval-1,e.regimen.duration=Math.round(e.regimen.duration/e.regimen.interval)*e.regimen.interval):void 0},e.increase_duration=function(){return e.regimen.duration=e.regimen.duration+e.regimen.interval},e.decrease_duration=function(){return e.regimen.duration>1?e.regimen.duration=e.regimen.duration-e.regimen.interval:void 0},$(t).find(".value").on("all",function(e){return e}),$(t).find(".value").keydown(function(e){return 13===e.keyCode?(e.preventDefault(),e.currentTarget.blur()):void 0})}]),e.directive("dna",function(){return{restrict:"A",link:function(e,t,r){return e.protocol.graph=t}}}),e.directive("pharmacodynamics",function(){return{restrict:"A",link:function(e,t,r){return e.protocol.pharmacodynamics=t}}}),e.directive("graph",function(){return{restrict:"A",link:function(e,t,r){return e.regimen.graph=t}}}),e.directive("protocol",function(){return{restrict:"E",templateUrl:"assets/templates/Protocol.html",controller:"ProtocolController",scope:!0}}),e.directive("regimen",function(){return{restrict:"E",templateUrl:"assets/templates/Regimen.html",controller:"RegimenController",scope:!0}})}).call(this);