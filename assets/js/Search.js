(function(){"use strict";var e;e=angular.module("Search",["Search","AthleteService","ProtocolService","PubNubService","CompoundService"]),e.controller("SearchController",["$scope","$rootScope","$timeout","Athlete","Protocol","PubNub","Compounds",function(e,o,r,n,c,t,s){var u,a,h,i;return i=1,e.selectTab=function(o){return e.$evalAsync(function(){switch(e.searchResults=[],o){case 1:return t("ProtocolService : Search",{q:"owner:athlete_alpha"});case 2:return e.showFavorites();case 3:return t("ProtocolService : Search",{q:"owner:"+n._id})}}),i=o},e.isSelected=function(e){return i===e},e.$on("Context Switch",function(o,r){return e.visibleSearch=_.contains(["Search"],r)}),e.minDays=1,e.maxDays=140,e.$on("PubNubService : Athlete Connected",function(){return r(function(){var o;return n.ffmi<20&&(e.experience="Beginner"),25>(o=n.ffmi)&&o>=20&&(e.experience="Intermediate"),n.ffmi>=25&&(e.experience="Advanced"),e.showFavorites(),e.selectTab(2)})}),e.Compounds=s,u=function(){return o.$broadcast("Editor : Focus Protocol")},e.createNewProtocol=_.debounce(u,2e3,!0),h=[],e.searchResults=[],window.Search=e,e.searchCompounds=[null,null],e.searchCompoundName=function(o){return null!=e.searchCompounds[o]?s(e.searchCompounds[o]).name:"Search By Compound"},e.searchCompoundColor=function(o){return null!=e.searchCompounds[o]?s(e.searchCompounds[o]).color:"none"},e.toggleSearchCompound=function(o){return null!=e.searchCompounds[o]?(e.searchCompounds[o]=null,e.search()):(e.choose_compound=!0,e.choose_compound_for=o)},e.chooseCompound=function(o){return e.searchCompounds[e.choose_compound_for]=o,e.search()},e.search=function(){var o,r;return r=e.strength||e.hypertrophy||e.recomposition||e.performance?[]:["Strength","Hypertrophy","Recomposition","Performance"],e.strength&&r.push("Strength"),e.hypertrophy&&r.push("Hypertrophy"),e.recomposition&&r.push("Recomposition"),e.performance&&r.push("Performance"),o="",null!=e.searchCompounds[0]&&null==e.searchCompounds[1]&&(o=" AND compound:"+e.searchCompounds[0]),null!=e.searchCompounds[1]&&null==e.searchCompounds[0]&&(o=" AND compound:"+e.searchCompounds[1]),null!=e.searchCompounds[0]&&null!=e.searchCompounds[1]&&(o=" AND compound:("+e.searchCompounds[1]+" AND "+e.searchCompounds[0]+")"),t("ProtocolService : Search",{q:"length:["+e.minDays+" TO "+e.maxDays+"] AND experience:"+e.experience+" AND goal:("+r.toString().replace(/,/g," OR ")+") AND "+(3===i?"owner:"+n._id:"public:true"+o)})},a=function(){return h.length>0&&e.searchResults.push(h.shift()),r(function(){return h.length>0&&$("#search_results")[0].getBoundingClientRect().bottom<=$(window).height()?a():void 0})},e.showFavorites=function(){var e,o,r,t;for(h=[],t=n.favorites,o=0,r=t.length;r>o;o++)e=t[o],h.push(c(e));return a()},$(window).scroll(function(){return e.visibleSearch?a():void 0}),e.$on("ProtocolService : Search Results",function(o,r){return e.$evalAsync(function(){var o,n,t,s;for(t=r.rows,o=0,n=t.length;n>o;o++)s=t[o],h.push(c(s.id));return e.searchResults=[],a()})}),e.$on("ProtocolService : Delete Protocol Complete",e.search)}]),e.directive("searchSection",function(){return{restrict:"E",templateUrl:"assets/templates/Search.html",controller:"SearchController",scope:!0,replace:!0}})}).call(this);