// Generated by CoffeeScript 1.9.2
(function() {
  'use strict';
  var app;

  app = angular.module('Order', ['ProtocolService', 'AthleteService', 'CompoundService', 'BTCService']);


  /*                     Controllers */

  app.controller('OrderController', [
    '$rootScope', '$scope', '$http', '$element', '$timeout', 'BTCrate', 'Protocol', 'Athlete', 'Compounds', 'Order', function($rootScope, $scope, $http, $element, $timeout, BTCrate, Protocol, Athlete, Compounds, Order) {
      $scope.orders = Order.get();
      $scope.BTCrate = BTCrate;
      $scope.Athlete = Athlete;
      $scope.Compounds = Compounds;
      $scope.$on('Context Switch', function(e, context) {
        return $scope.visibleOrders = _.contains(['Athlete Profile'], context);
      });
      $scope.statusIsPayment = function(i) {
        return $scope.orders[i].fulfillment.paymentRecieved === false;
      };
      $scope.statusIsFormulating = function(i) {
        return $scope.orders[i].fulfillment.paymentRecieved === true && $scope.orders[i].fulfillment.shipped === false;
      };
      $scope.statusIsShipped = function(i) {
        return $scope.orders[i].fulfillment.shipped === true;
      };
      return $scope.shippingBarLength = function(i) {
        var finish, full, now, start, today;
        if (Orders[i].trackingInfo == null) {
          return '0';
        }
        today = new Date();
        start = _.last(Orders[i].trackingInfo.history).date;
        finish = Orders[i].trackingInfo.deliveryDay;
        full = finish - start;
        now = (finish - today) < 0 ? finish - start : finish - today;
        if ((now / full) > 1) {
          return '34rem';
        } else {
          return ((now / full) * 34) + 'rem';
        }
      };
    }
  ]);


  /*                      Directives */

  app.directive('ordersSection', function() {
    return {
      restrict: 'E',
      templateUrl: 'assets/templates/Order.html',
      controller: 'OrderController',
      scope: true,
      replace: true
    };
  });

}).call(this);
