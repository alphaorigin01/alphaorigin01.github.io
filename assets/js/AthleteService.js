(function(){"use strict";var e;e=angular.module("AthleteService",["PubNubService"]),e.factory("Athlete",["PubNub","$rootScope","$http",function(e,t,n){var r,i;return window.rootScope=t,r=function(){function r(){var r,i,o,u,c,s,f,a,h,l,d;h=this,f=function(){return null!=h._id?e("AthleteService : Set Athlete",h):void 0},f=_.debounce(f,1e3),this.stars={},this.setStars=function(t,n){return e("ProtocolService : Set Stats",{_id:t,previous:n[t]?n[t]:0,current:n}),this.stars[t]=n,f()},c=null,Object.defineProperty(this,"password",{enumerable:!1,get:function(){return c},set:function(e){var t;return t=null===c,e===c||(c=e,t)?void 0:f()}}),a=crypto.getRandomValues(new Uint8Array(32)),a.toJSON=function(){return PUBNUB.raw_encrypt(_.flatten(a),c)},Object.defineProperty(this,"secretKey",{enumerable:!0,get:function(){return a},set:function(e){return a=new Uint8Array(PUBNUB.raw_decrypt(e,c)),a.toJSON=function(){return PUBNUB.raw_encrypt(_.flatten(a),c)}}}),s=nacl.box.generate_pubkey(a),Object.defineProperty(this,"publicKey",{enumerable:!1,get:function(){return s},set:function(e){return s=new Uint8Array(e)}}),this.favorites=[],this.toggleFavorite=function(e){return _.indexOf(this.favorites,e)>=0?(_.remove(this.favorites,function(t){return t===e}),f()):(this.favorites.push(e),f())},u=null,Object.defineProperty(this,"height",{enumerable:!0,get:function(){return u},set:function(e){return u!==e?(u=Math.round(1e3*e)/1e3,f()):void 0}}),d=null,Object.defineProperty(this,"weight",{enumerable:!0,get:function(){return d},set:function(e){return d!==e?(d=Math.round(10*e)/10,f()):void 0}}),i=null,Object.defineProperty(this,"bodyFat",{enumerable:!0,get:function(){return i},set:function(e){return i!==e?(i=Math.round(100*e)/100,f()):void 0}}),o=0,Object.defineProperty(this,"ffmiOffset",{enumerable:!0,get:function(){return o},set:function(e){return o!==e?(o=Math.round(100*e)/100,f()):void 0}}),Object.defineProperty(this,"lbm",{get:function(){return this.weight*(1-.01*this.bodyFat)},set:function(){}}),Object.defineProperty(this,"ffmi",{get:function(){return this.lbm/(this.height*this.height)+6*(this.height-1.8)+this.ffmiOffset},set:function(){}}),r=0,l=function(){return n.get("https://blockchain.info/q/addressbalance/"+h.BTCAddress+"?confirmations=6&cors=true").success(function(e){return t.$evalAsync(function(){return r=h.accountCredit+e/1e8})})},Object.defineProperty(this,"accountBalance",{get:function(){return r},set:l}),t.$on("AthleteService : Update Athlete",function(e,n){return n._id===h._id?t.$evalAsync(function(){return h.secretKey=n.secretKey,0!==h.secretKey.length?(_.extend(h,n),l(),t.$broadcast("Context Switch","Search"),t.$broadcast("PubNubService : Initialize Athlete")):void 0}):void 0}),t.$on("AthleteService : Set Athlete Complete",function(e,t){return t.id===h._id?h._rev=t.rev:void 0})}return r}(),window.Athlete=i=new r,t.$on("AthleteService : Login",function(t,n){return i._id="athlete_"+n.username,i.password=n.password,e("AthleteService : Get Athlete",i)}),i}])}).call(this);