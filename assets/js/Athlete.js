// Generated by CoffeeScript 1.9.2
(function() {
  'use strict';
  var app;

  app = angular.module('Athlete', ['AthleteService', 'BTCService', 'PubNubService']);


  /*                      Controllers */

  app.controller('AthleteMetricsController', [
    '$scope', '$element', 'Athlete', 'BTCrate', 'PubNub', function($scope, $element, Athlete, BTCrate, PubNub) {
      var scrollMessages;
      $scope.athlete = Athlete;
      $scope.balanceInBTC = Athlete.accountCredit;
      $scope.balanceInUSD = function() {
        return Athlete.accountBalance / BTCrate();
      };
      scrollMessages = function() {
        return $('#messages > .history').scrollTop($('#messages > .history')[0].scrollHeight);
      };
      $('.dial').knob();
      $scope.$on('AthleteService : Set Athlete', function(e, context) {
        $('.lean_body_mass').find('.dial').val(Athlete.lbm).trigger('change');
        return $('.fat_free_mass_index').find('.dial').val(Athlete.ffmi).trigger('change');
      });
      $scope.$on('Context Switch', function(e, context) {
        $scope.visibleAthleteMetricsAside = _.contains(['Search', 'Editor'], context);
        $scope.visibleAccount = _.contains(['Athlete Profile'], context);
        return $scope.visibleAthleteMetrics = _.contains(['Athlete Profile'], context);
      });
      $scope.generateInvitation = function() {
        return PubNub('AthleteService : New Invitation', {
          athlete: Athlete._id
        });
      };
      $scope.$on('AthleteService : Invitation Generated', function(e, data) {
        return $scope.$evalAsync(function() {
          if (data.athlete === Athlete._id) {
            return $scope.invitationCode = data._id.substring(11);
          }
        });
      });
      $scope.savePassword = function() {
        if (($scope.newPassword != null) && $scope.newPassword !== '') {
          return Athlete.password = $scope.newPassword;
        }
      };
      return $scope.$on('AthleteService : Set Athlete Complete', function() {
        return $scope.$evalAsync(function() {
          return $scope.newPassword = '';
        });
      });
    }
  ]);


  /*                      Directives */

  app.directive('athleteMetricsSection', function() {
    return {
      restrict: 'E',
      templateUrl: 'assets/templates/AthleteMetrics.html',
      controller: 'AthleteMetricsController',
      scope: true,
      replace: true
    };
  });

  app.directive('athleteMetricsAside', function() {
    return {
      restrict: 'E',
      templateUrl: 'assets/templates/AthleteMetricsAside.html',
      controller: 'AthleteMetricsController',
      scope: true,
      replace: true
    };
  });

  app.directive('account', function() {
    return {
      restrict: 'E',
      templateUrl: 'assets/templates/Account.html',
      controller: 'AthleteMetricsController',
      scope: true,
      replace: true
    };
  });

}).call(this);
